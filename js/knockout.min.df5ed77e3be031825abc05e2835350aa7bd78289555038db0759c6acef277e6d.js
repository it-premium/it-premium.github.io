validateEmail=(email)=>{re=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/i;return re.test(email);};async function postData(url='',data={}){const response=await fetch(url,{method:'POST',mode:'cors',cache:'no-cache',credentials:'same-origin',headers:{'Content-Type':'application/json'},redirect:'follow',referrerPolicy:'no-referrer',body:JSON.stringify(data)});return await response.json();}
function Package(name){var self=this;self.name=name;self.value=ko.observable(0);}
function Customer(){self=this;self.name=ko.observable('');self.nameValid=ko.observable(true);self.company=ko.observable('');self.phone=ko.observable('');self.email=ko.observable('');self.emailValid=ko.observable(true);self.validateName=()=>{return self.name().length>0;};self.validateEmail=()=>{if(self.name().length==0){return false;};return validateEmail(self.email());};self.validate=()=>{if(!self.validateName()){self.nameValid(false);}else{self.nameValid(true);}
if(!self.validateEmail()){self.emailValid(false);}else{self.emailValid(true);};return self.nameValid()&&self.emailValid();};}
function Proposition(obj){var self=this;self.id=obj.id;self.name=obj.name;self.price=obj.price;self.label='proposition_'+obj.id.toString();self.input_name=obj.input_name;self.has_input=obj.has_input;self.value=ko.observable(obj.default_selected||1);self.checked=ko.observable(obj.default_selected);self.incrementCounter=function(){self.value(self.value()+1);self.checked(true);};self.decrementCounter=function(){if(self.value()>1){self.value(self.value()-1);}else{self.value(0);self.checked(false);}};}
var FrontendViewModel=function(){var self=this;self.propositions=ko.observableArray();self.packages=ko.observableArray();self.toggler=ko.observable(false);self.burgerActive=ko.observable(false);self.burgerStatus=ko.pureComputed(()=>{if(self.burgerActive()){return "is-active";};return "";});self.customer=new Customer();self.thanksActive=ko.observable(false);self.proposalActive=ko.observable(false);self.proposalActiveClass=ko.pureComputed(()=>{return self.proposalActive()?"is-active":"";});self.proposalSubmit=()=>{if(!self.customer.validate()){return false;};postData('https://jsonplaceholder.typicode.com/posts',ko.mapping.toJS(self.customer)).then((data)=>{console.log(data);self.proposalActive(false);self.thanksActive(true);});};self.toggleProposal=()=>{self.proposalActive(!self.proposalActive());};self.closeProposal=()=>{self.proposalActive(false);self.thanksActive(false);};self.toggleBurger=()=>{self.burgerActive(!self.burgerActive());};self.selectedPackage=(name)=>{return self.packages().filter(item=>item.name==name)[0];};self.toggleBack=()=>{self.toggler(!self.toggler());};self.calculate=function(){let map_price=self.propositions().map(item=>item.checked()?item.price*item.value():0);const reducer=(accumulator,currentValue)=>accumulator+currentValue;let sum=map_price.reduce(reducer);self.selectedPackage('start').value(500);self.selectedPackage('classic').value(sum);self.selectedPackage('gold').value(sum*1.5);self.selectedPackage('premium').value(sum*2);self.toggler(!self.toggler());};};window.frontend=new FrontendViewModel();window.frontend.packages.push(new Package('start',500));window.frontend.packages.push(new Package('classic'));window.frontend.packages.push(new Package('gold'));window.frontend.packages.push(new Package('premium'));window.data.forEach(function(item){window.frontend.propositions.push(new Proposition(item));});ko.applyBindings(frontend);